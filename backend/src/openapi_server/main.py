# coding: utf-8

"""
    MDL Assignment

    Shopping Mall Demo

    The version of the OpenAPI document: 1.0
    Generated by: https://openapi-generator.tech
"""


import uvicorn
from fastapi import FastAPI, Path
from starlette.responses import JSONResponse

import os
from fastapi import FastAPI

from apis.products_api import router as ProductsApiRouter
from apis.users_api import router as UsersApiRouter

import uvicorn
from fastapi.middleware.cors import CORSMiddleware
from starlette.responses import JSONResponse

from pydantic import BaseModel
from db.db_pool import get_db_pool, get_db_conn

app = FastAPI(
    title="MDL Assignment",
    description="Shopping Mall Demo",
    version="1.0",
)

urls = os.environ.get("ORIGINS_URL") or "http://localhost,http://localhost:80"

origins = urls.split(",")

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


app.include_router(ProductsApiRouter)
app.include_router(UsersApiRouter)

db_user = os.environ.get("DB_USERNAME") or "testuser"
db_pw = os.environ.get("DB_PASSWORD") or "1234"
db_host = os.environ.get("DB_HOST") or "10.99.80.67"
db_port = os.environ.get("DB_PORT")  or "5432"
db_name = os.environ.get("DB_NAME") or "mdl"

get_db_pool().init_app(app, DB_HOST = db_host, DB_PORT = db_port, DB_USER = db_user, DB_PW = db_pw, DB_NAME = db_name )

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=5252)
